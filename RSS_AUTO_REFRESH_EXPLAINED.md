# RSS è‡ªåŠ¨åˆ·æ–°æœºåˆ¶è¯¦è§£

> ç”¨å¤§ç™½è¯è®²æ¸…æ¥š SaveHub æ˜¯æ€ä¹ˆç”¨ FastAPI + Celery + Redis å®ç° RSS è‡ªåŠ¨åˆ·æ–°çš„

## ä¸€å¥è¯æ€»ç»“

**ç”¨æˆ·è®¢é˜… RSS â†’ åç«¯æŠŠ"åˆ·æ–°ä»»åŠ¡"ä¸¢è¿› Redis é˜Ÿåˆ— â†’ Celery Worker ä»é˜Ÿåˆ—å–ä»»åŠ¡æ‰§è¡Œ â†’ è§£æ RSS ä¿å­˜æ–‡ç«  â†’ è‡ªåŠ¨å®‰æ’ä¸‹æ¬¡åˆ·æ–°**

---

## æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·æ“ä½œ                                        â”‚
â”‚  (ç‚¹å‡»"åˆ·æ–°"æŒ‰é’® / æ·»åŠ æ–°è®¢é˜… / æ‰“å¼€App)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   FastAPI åç«¯                                       â”‚
â”‚  ğŸ“„ backend/app/api/routers/queue.py                                â”‚
â”‚                                                                      â”‚
â”‚  æ”¶åˆ°è¯·æ±‚ â†’ åˆ›å»º Celery ä»»åŠ¡ â†’ ä¸¢è¿› Redis é˜Ÿåˆ—                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Redis                                            â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚ high é˜Ÿåˆ—    â”‚    â”‚ default é˜Ÿåˆ—  â”‚                               â”‚
â”‚  â”‚ (ç«‹å³åˆ·æ–°)   â”‚    â”‚ (å®šæ—¶åˆ·æ–°)    â”‚                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                      â”‚
â”‚  è¿˜å­˜å‚¨ï¼šä»»åŠ¡é”ã€é™æµä¿¡æ¯ã€ä»»åŠ¡ç»“æœ                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Celery Worker                                       â”‚
â”‚  ğŸ“„ backend/app/celery_app/tasks.py                                 â”‚
â”‚                                                                      â”‚
â”‚  ä»é˜Ÿåˆ—å–ä»»åŠ¡ â†’ è§£æRSS â†’ ä¿å­˜æ–‡ç«  â†’ å®‰æ’ä¸‹æ¬¡åˆ·æ–°                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Supabase æ•°æ®åº“                                    â”‚
â”‚                                                                      â”‚
â”‚  feeds è¡¨ï¼šè®¢é˜…ä¿¡æ¯ã€æœ€ååˆ·æ–°æ—¶é—´                                    â”‚
â”‚  articles è¡¨ï¼šæ–‡ç« å†…å®¹                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶

### 1. Redis - ä»»åŠ¡çš„"æ’é˜Ÿçª—å£"

**ç±»æ¯”**ï¼šé“¶è¡Œå«å·æœº

Redis åœ¨è¿™é‡Œçš„ä½œç”¨ï¼š
- **ä»»åŠ¡é˜Ÿåˆ—**ï¼šå­˜æ”¾å¾…æ‰§è¡Œçš„åˆ·æ–°ä»»åŠ¡
- **ä»»åŠ¡é”**ï¼šé˜²æ­¢åŒä¸€ä¸ª Feed è¢«é‡å¤åˆ·æ–°
- **é™æµå™¨**ï¼šæ§åˆ¶å¯¹åŒä¸€ç½‘ç«™çš„è¯·æ±‚é¢‘ç‡

**ä¸¤ä¸ªé˜Ÿåˆ—**ï¼ˆè§ `backend/app/celery_app/celery.py:47-50`ï¼‰ï¼š
| é˜Ÿåˆ— | ç”¨é€” | ä¼˜å…ˆçº§ |
|------|------|--------|
| `high` | ç”¨æˆ·æ‰‹åŠ¨ç‚¹"åˆ·æ–°" | é«˜ï¼ˆä¼˜å…ˆå¤„ç†ï¼‰ |
| `default` | è‡ªåŠ¨å®šæ—¶åˆ·æ–° | æ™®é€š |

### 2. Celery Worker - å¹²æ´»çš„"å‘˜å·¥"

**ç±»æ¯”**ï¼šé“¶è¡ŒæŸœå‘˜

Worker åšçš„äº‹ï¼ˆæ ¸å¿ƒé€»è¾‘åœ¨ `backend/app/celery_app/tasks.py:155-281`ï¼‰ï¼š
1. ä» Redis é˜Ÿåˆ—å–å‡ºä¸€ä¸ªä»»åŠ¡
2. è·å–ä»»åŠ¡é”ï¼ˆé˜²é‡å¤ï¼‰
3. ç­‰å¾…é™æµï¼ˆé˜²è¢«æ‹‰é»‘ï¼‰
4. æ‰§è¡Œä»»åŠ¡ï¼ˆè®¿é—® RSS æºã€è§£æå†…å®¹ï¼‰
5. æŠŠç»“æœå­˜åˆ°æ•°æ®åº“
6. å®‰æ’ä¸‹ä¸€æ¬¡åˆ·æ–°ä»»åŠ¡
7. é‡Šæ”¾é”ï¼Œç»§ç»­å–ä¸‹ä¸€ä¸ªä»»åŠ¡

### 3. FastAPI - æ¥å¾…çš„"å‰å°"

**ç±»æ¯”**ï¼šé“¶è¡Œå¤§å ‚ç»ç†

FastAPI åšçš„äº‹ï¼ˆè§ `backend/app/api/routers/queue.py:34-121`ï¼‰ï¼š
- æ¥æ”¶ç”¨æˆ·è¯·æ±‚ï¼ˆ"æˆ‘è¦åˆ·æ–°è¿™ä¸ª Feed"ï¼‰
- åˆ›å»º Celery ä»»åŠ¡å¹¶æ”¾å…¥é˜Ÿåˆ—
- è¿”å›ä»»åŠ¡ IDï¼ˆ"æ‚¨çš„å·æ˜¯ A001ï¼Œè¯·ç­‰å€™"ï¼‰

---

## è¯¦ç»†æµç¨‹è®²è§£

### åœºæ™¯ 1ï¼šç”¨æˆ·ç‚¹å‡»"åˆ·æ–°"æŒ‰é’®

**æ­¥éª¤åˆ†è§£**ï¼š

1ï¸âƒ£ **å‰ç«¯è°ƒç”¨ API**
> ğŸ“„ `frontend/lib/queue-client.ts:51-74`

```typescript
await fetch("/api/backend/queue/schedule-feed", {
  body: JSON.stringify({ feed_id: feedId, force_immediate: true })
})
```

2ï¸âƒ£ **åç«¯æ”¶åˆ°è¯·æ±‚ï¼Œæ£€æŸ¥æ˜¯å¦å·²åœ¨è¿è¡Œ**
> ğŸ“„ `backend/app/api/routers/queue.py:64-72`

å¦‚æœå·²æœ‰ä»»åŠ¡åœ¨è¿è¡Œï¼Œç›´æ¥è¿”å› `"already_running"`

3ï¸âƒ£ **åˆ›å»ºé«˜ä¼˜å…ˆçº§ä»»åŠ¡**
> ğŸ“„ `backend/app/api/routers/queue.py:74-91`

```python
refresh_feed.apply_async(..., queue="high")  # æ”¾å…¥é«˜ä¼˜å…ˆçº§é˜Ÿåˆ—
```

4ï¸âƒ£ **Worker æ‰§è¡Œä»»åŠ¡**
> ğŸ“„ `backend/app/celery_app/tasks.py:168-281`

ä» `high` é˜Ÿåˆ—å–å‡ºä»»åŠ¡ï¼Œç«‹å³æ‰§è¡Œ

---

### åœºæ™¯ 2ï¼šè‡ªåŠ¨å®šæ—¶åˆ·æ–°

**æ­¥éª¤åˆ†è§£**ï¼š

1ï¸âƒ£ **Worker å®Œæˆåˆ·æ–°åï¼Œè‡ªåŠ¨å®‰æ’ä¸‹æ¬¡**
> ğŸ“„ `backend/app/celery_app/tasks.py:283-336`

```python
def schedule_next_refresh(feed_id, refresh_interval):
    delay_seconds = refresh_interval * 60
    refresh_feed.apply_async(..., countdown=delay_seconds, queue="default")
```

2ï¸âƒ£ **Redis è®°ä½è¿™ä¸ªä»»åŠ¡**ï¼Œç­‰ `countdown` æ—¶é—´åˆ°äº†å†æ”¾å…¥é˜Ÿåˆ—

3ï¸âƒ£ **Worker åˆ°æ—¶é—´ä»é˜Ÿåˆ—å–å‡ºæ‰§è¡Œ**

**ä¸¾ä¾‹**ï¼š
- Feed A çš„åˆ·æ–°é—´éš”æ˜¯ 30 åˆ†é’Ÿ
- 10:00 åˆ·æ–°å®Œæˆ â†’ åˆ›å»ºä»»åŠ¡ `countdown=1800ç§’`
- 10:30 ä»»åŠ¡è¿›å…¥é˜Ÿåˆ— â†’ Worker æ‰§è¡Œ
- å¾ªç¯å¾€å¤...

---

## é˜²é‡å¤æœºåˆ¶ï¼šTaskLock

> ğŸ“„ `backend/app/celery_app/task_lock.py`

**é—®é¢˜**ï¼šç”¨æˆ·å¿«é€Ÿç‚¹å‡» 3 æ¬¡"åˆ·æ–°"ï¼Œä¼šåˆ›å»º 3 ä¸ªä»»åŠ¡åŒæ—¶è¯·æ±‚ï¼Ÿ

**è§£å†³**ï¼šç”¨ Redis å®ç°"ä»»åŠ¡é”"

**æ ¸å¿ƒä»£ç **ï¼ˆ`task_lock.py:31-60`ï¼‰ï¼š
```python
def acquire(self, lock_key, ttl_seconds, task_id):
    # NX: åªæœ‰ key ä¸å­˜åœ¨æ—¶æ‰èƒ½è®¾ç½®ï¼ˆåŸå­æ“ä½œï¼‰
    acquired = self.redis.set(full_key, value, nx=True, ex=ttl_seconds)
    return bool(acquired)
```

**åœ¨åˆ·æ–°ä»»åŠ¡ä¸­çš„ä½¿ç”¨**ï¼ˆ`tasks.py:200-214`ï¼‰ï¼š
```python
lock_key = f"feed:{feed_id}"
if not task_lock.acquire(lock_key, lock_ttl=180, task_id):
    raise Reject("Feed is locked", requeue=False)
```

**æ‰§è¡Œé€»è¾‘**ï¼š
```
ç‚¹å‡»ç¬¬1æ¬¡ â†’ è·å–é” âœ“ â†’ æ‰§è¡Œä»»åŠ¡
ç‚¹å‡»ç¬¬2æ¬¡ â†’ è·å–é” âœ— â†’ è¿”å›"æ­£åœ¨åˆ·æ–°ä¸­"
ç‚¹å‡»ç¬¬3æ¬¡ â†’ è·å–é” âœ— â†’ è¿”å›"æ­£åœ¨åˆ·æ–°ä¸­"
ä»»åŠ¡å®Œæˆ â†’ é‡Šæ”¾é”ï¼ˆtasks.py:279-280ï¼‰
```

---

## é™æµæœºåˆ¶ï¼šRateLimiter

> ğŸ“„ `backend/app/celery_app/rate_limiter.py`

**é—®é¢˜**ï¼šè®¢é˜…äº† 10 ä¸ªæ¥è‡ª `example.com` çš„ Feedï¼ŒåŒæ—¶åˆ·æ–°ä¼šè¢«ç½‘ç«™æ‹‰é»‘

**è§£å†³**ï¼šå¯¹æ¯ä¸ªåŸŸåé™åˆ¶è¯·æ±‚é¢‘ç‡ï¼ˆ1 ç§’ 1 æ¬¡ï¼‰

**æ ¸å¿ƒé€»è¾‘**ï¼ˆ`rate_limiter.py:27-41`ï¼‰ï¼šä½¿ç”¨ Lua è„šæœ¬ä¿è¯åŸå­æ€§
```lua
local ttl = redis.call('PTTL', key)
if ttl <= 0 then
    redis.call('SET', key, '1', 'PX', interval_ms)
    return 0  -- å¯ä»¥æ‰§è¡Œ
else
    return ttl  -- éœ€è¦ç­‰å¾…çš„æ¯«ç§’æ•°
end
```

**ç­‰å¾…é€»è¾‘**ï¼ˆ`rate_limiter.py:57-99`ï¼‰ï¼š
```python
def wait_for_domain(self, url, max_wait_seconds=30):
    domain = urlparse(url).hostname
    # å¾ªç¯ç­‰å¾…ç›´åˆ°å¯ä»¥è¯·æ±‚
    while total_waited < max_wait_seconds:
        wait_ms = self._check_and_set(...)
        if wait_ms == 0:
            return  # å¯ä»¥æ‰§è¡Œäº†
        time.sleep(wait_ms / 1000)
```

**åœ¨åˆ·æ–°ä»»åŠ¡ä¸­çš„ä½¿ç”¨**ï¼ˆ`tasks.py:77-83`ï¼‰ï¼š
```python
waited = rate_limiter.wait_for_domain(feed_url, max_wait_seconds=30)
```

---

## å…³é”®é…ç½®ä¸€è§ˆ

### Celery é…ç½®
> ğŸ“„ `backend/app/celery_app/celery.py:23-54`

| é…ç½®é¡¹ | å€¼ | è¯´æ˜ |
|--------|-----|------|
| `worker_concurrency` | 5 | åŒæ—¶å¤„ç† 5 ä¸ªä»»åŠ¡ |
| `task_acks_late` | True | ä»»åŠ¡å®Œæˆåæ‰ç¡®è®¤ï¼ˆé˜²ä¸¢å¤±ï¼‰|
| `task_default_queue` | "default" | é»˜è®¤é˜Ÿåˆ— |

### ä»»åŠ¡é…ç½®
> ğŸ“„ `backend/app/celery_app/tasks.py:155-167`

| é…ç½®é¡¹ | å€¼ | è¯´æ˜ |
|--------|-----|------|
| `max_retries` | 3 | æœ€å¤šé‡è¯• 3 æ¬¡ |
| `retry_backoff` | True | æŒ‡æ•°é€€é¿ï¼š2s â†’ 4s â†’ 8s |
| `time_limit` | 120 | ç¡¬è¶…æ—¶ 2 åˆ†é’Ÿ |
| `soft_time_limit` | 90 | è½¯è¶…æ—¶ 1.5 åˆ†é’Ÿ |

### TaskLock é…ç½®
> ğŸ“„ `backend/app/celery_app/tasks.py:206`

| é…ç½®é¡¹ | å€¼ | è¯´æ˜ |
|--------|-----|------|
| `lock_ttl` | 180ç§’ | é”è¿‡æœŸæ—¶é—´ï¼ˆ> ä»»åŠ¡è¶…æ—¶æ—¶é—´ï¼‰|

---

## å…³é”®æ–‡ä»¶è·¯å¾„é€ŸæŸ¥

| åŠŸèƒ½ | æ–‡ä»¶ | å…³é”®è¡Œå· |
|------|------|----------|
| **Celery é…ç½®** | `backend/app/celery_app/celery.py` | 16-54 |
| **åˆ·æ–°ä»»åŠ¡å®šä¹‰** | `backend/app/celery_app/tasks.py` | 155-281 |
| **æ ¸å¿ƒåˆ·æ–°é€»è¾‘** | `backend/app/celery_app/tasks.py` | 57-128 |
| **è‡ªåŠ¨è°ƒåº¦ä¸‹æ¬¡** | `backend/app/celery_app/tasks.py` | 283-336 |
| **ä»»åŠ¡é”** | `backend/app/celery_app/task_lock.py` | 20-127 |
| **åŸŸåé™æµå™¨** | `backend/app/celery_app/rate_limiter.py` | 20-111 |
| **API è°ƒåº¦ç«¯ç‚¹** | `backend/app/api/routers/queue.py` | 34-121 |
| **API ä»»åŠ¡çŠ¶æ€** | `backend/app/api/routers/queue.py` | 136-157 |
| **å‰ç«¯é˜Ÿåˆ—å®¢æˆ·ç«¯** | `frontend/lib/queue-client.ts` | 51-97 |

---

## å¦‚ä½•å¯åŠ¨ï¼Ÿ

### 1. å¯åŠ¨ Redis
```bash
redis-server
# æˆ–ç”¨ Docker
docker run -d -p 6379:6379 redis
```

### 2. å¯åŠ¨ FastAPI åç«¯
```bash
cd backend
uvicorn app.main:app --reload --port 8000
```

### 3. å¯åŠ¨ Celery Worker
```bash
cd backend
# Windowsï¼ˆå¿…é¡»åŠ  --pool=soloï¼‰
celery -A app.celery_app worker --loglevel=info --queues=high,default --pool=solo

# Linux/Mac
celery -A app.celery_app worker --loglevel=info --queues=high,default
```

### 4. ï¼ˆå¯é€‰ï¼‰å¯åŠ¨ Flower ç›‘æ§
```bash
celery -A app.celery_app flower --port=5555
# è®¿é—® http://localhost:5555
```

---

## å¸¸è§é—®é¢˜

### Q: ä»»åŠ¡å †ç§¯æ€ä¹ˆåŠï¼Ÿ
æ£€æŸ¥ Worker æ˜¯å¦åœ¨è¿è¡Œï¼Œæˆ–å¢åŠ å¹¶å‘æ•°ï¼ˆ`celery.py:35`ï¼‰

### Q: å¦‚ä½•æŸ¥çœ‹é˜Ÿåˆ—çŠ¶æ€ï¼Ÿ
```bash
redis-cli
> LLEN high      # é«˜ä¼˜å…ˆçº§é˜Ÿåˆ—é•¿åº¦
> LLEN default   # æ™®é€šé˜Ÿåˆ—é•¿åº¦
```

### Q: ä»»åŠ¡é‡å¤æ‰§è¡Œï¼Ÿ
æ£€æŸ¥ TaskLock æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š
```bash
redis-cli
> GET tasklock:feed:{feed_id}
```

---

## ä¸€å›¾æ€»ç»“

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        RSS è‡ªåŠ¨åˆ·æ–°æµç¨‹                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚   ç”¨æˆ·è®¢é˜… Feed                                                      â”‚
â”‚        â”‚                                                             â”‚
â”‚        â–¼                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚
â”‚   â”‚ FastAPI API â”‚ â”€â”€åˆ›å»ºä»»åŠ¡â”€â”€â–¶ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚   â”‚ queue.py    â”‚               â”‚  Redis  â”‚                        â”‚
â”‚   â”‚ :34-121     â”‚               â”‚  é˜Ÿåˆ—   â”‚                        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚ â”Œâ”€â”€â”€â”€â”€â” â”‚                        â”‚
â”‚                                 â”‚ â”‚high â”‚ â”‚ â—€â”€â”€ ç«‹å³åˆ·æ–°           â”‚
â”‚   ç”¨æˆ·ç‚¹"åˆ·æ–°" â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚ â”œâ”€â”€â”€â”€â”€â”¤ â”‚                        â”‚
â”‚                                 â”‚ â”‚defltâ”‚ â”‚ â—€â”€â”€ å®šæ—¶åˆ·æ–°           â”‚
â”‚   å®šæ—¶è§¦å‘ â”€â”€â”€â”€countdownâ”€â”€â”€â”€â”€â”€â”€â–¶ â”‚ â””â”€â”€â”€â”€â”€â”˜ â”‚                        â”‚
â”‚                                 â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                        â”‚
â”‚                                      â”‚                              â”‚
â”‚                                      â–¼                              â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                              â”‚Celery Worker â”‚                       â”‚
â”‚                              â”‚ tasks.py     â”‚                       â”‚
â”‚                              â”‚ :155-281     â”‚                       â”‚
â”‚                              â”‚              â”‚                       â”‚
â”‚                              â”‚ 1. è·å–é”    â”‚ â† task_lock.py:31    â”‚
â”‚                              â”‚ 2. ç­‰é™æµ    â”‚ â† rate_limiter.py:57 â”‚
â”‚                              â”‚ 3. è¯·æ±‚RSS   â”‚ â† tasks.py:85-95     â”‚
â”‚                              â”‚ 4. ä¿å­˜æ–‡ç«   â”‚ â† tasks.py:97-127    â”‚
â”‚                              â”‚ 5. å®‰æ’ä¸‹æ¬¡  â”‚ â† tasks.py:283-336   â”‚
â”‚                              â”‚ 6. é‡Šæ”¾é”    â”‚ â† tasks.py:279-280   â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ€»ç»“

è¿™å¥—æœºåˆ¶çš„ç²¾é«“ï¼š

1. **å¼‚æ­¥è§£è€¦**ï¼šç”¨æˆ·ä¸ç”¨ç­‰ RSS è§£æå®Œæˆï¼Œä»»åŠ¡æ”¾é˜Ÿåˆ—åå°æ‰§è¡Œ
2. **é˜²é‡å¤**ï¼šTaskLock ä¿è¯åŒä¸€ Feed ä¸ä¼šè¢«åŒæ—¶åˆ·æ–°
3. **é˜²è¢«æ‹‰é»‘**ï¼šRateLimiter é™åˆ¶å¯¹åŒä¸€åŸŸåçš„è¯·æ±‚é¢‘ç‡
4. **è‡ªåŠ¨å¾ªç¯**ï¼šæ¯æ¬¡åˆ·æ–°å®Œæˆè‡ªåŠ¨å®‰æ’ä¸‹æ¬¡ï¼Œæ— éœ€äººå·¥å¹²é¢„
5. **å®¹é”™**ï¼šWorker æŒ‚äº†é‡å¯ï¼Œä»»åŠ¡ä¸ä¸¢å¤±ï¼ˆ`task_acks_late=True`ï¼‰
