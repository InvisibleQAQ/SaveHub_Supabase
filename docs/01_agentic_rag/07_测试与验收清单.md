# 测试与验收清单（按阶段执行）

## A. 基础可用性

- [ ] `POST /api/agentic-rag/stream` 能建立 SSE 连接
- [ ] 正常问题能收到 `rewrite -> tool_call -> tool_result -> content -> done`
- [ ] 前端无报错，流式文本连续

## B. Human-in-the-loop

- [ ] 输入模糊问题时收到 `clarification_required`
- [ ] 用户补充后能继续问答
- [ ] 澄清消息不会破坏会话上下文

## C. 多问题拆分与聚合

- [ ] 输入复合问题（例如 A+B）时至少拆分2个子问题
- [ ] 最终输出为聚合答案（含每个部分信息）
- [ ] 聚合后引用编号连续且可点击

## D. 引用与来源卡片

- [ ] 回答中出现 `[ref:N]`
- [ ] 点击 marker 可弹出来源卡片
- [ ] article 卡片字段正确
- [ ] repository 卡片字段正确（owner/star/language/description）

## E. 仅基于知识库约束

- [ ] 知识库无相关内容时，回答明确说明无法从知识库得到答案
- [ ] 不出现明显外部常识扩写
- [ ] 每个关键结论有引用支撑

## F. 异常处理

- [ ] 工具超时/失败时可返回 `error` 或可恢复提示
- [ ] SSE 中断时前端有友好错误反馈
- [ ] Chat API 配置异常时有明确提示

## G. 代码质量检查

- [ ] `pnpm frontend:lint` 通过
- [ ] 后端服务启动无导入错误
- [ ] 新增模块有基础日志（rewrite/tool_call/tool_result/done）

---

## 建议验收用例（手工）

1. **简单事实问答**：只需1次检索
2. **多问题复合问答**：触发拆分与聚合
3. **含代词追问**：触发改写上下文融合
4. **含歧义问题**：触发 clarification_required
5. **空命中问题**：验证仅知识库回答策略

