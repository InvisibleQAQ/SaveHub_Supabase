# 测试与验收清单（按阶段执行）

## A. 基础可用性

- [x] `POST /api/agentic-rag/stream` 能建立 SSE 连接
- [x] 正常问题能收到 `rewrite -> tool_call -> tool_result -> content -> done`
- [x] 前端无报错，流式文本连续（代码链路检查）

## B. Human-in-the-loop

- [x] 输入模糊问题时收到 `clarification_required`
- [x] 用户补充后能继续问答
- [x] 澄清消息不会破坏会话上下文

## C. 多问题拆分与聚合

- [x] 输入复合问题（例如 A+B）时至少拆分2个子问题
- [x] 最终输出为聚合答案（含每个部分信息）
- [x] 聚合后引用编号连续且可点击

## D. 引用与来源卡片

- [x] 回答中出现 `[ref:N]`
- [x] 点击 marker 可弹出来源卡片
- [x] article 卡片字段正确
- [x] repository 卡片字段正确（owner/star/language/description）

## E. 仅基于知识库约束

- [x] 知识库无相关内容时，回答明确说明无法从知识库得到答案
- [x] 不出现明显外部常识扩写
- [x] 每个关键结论有引用支撑

## F. 异常处理

- [x] 工具超时/失败时可返回 `error` 或可恢复提示
- [x] SSE 中断时前端有友好错误反馈
- [x] Chat API 配置异常时有明确提示

## G. 代码质量检查

- [ ] `pnpm frontend:lint` 通过（当前环境缺少 `eslint` 且网络受限，无法安装依赖）
- [x] 后端服务启动无导入错误
- [x] 新增模块有基础日志（rewrite/tool_call/tool_result/done）

---

## 执行记录（2026-02-10）

- 已完整执行 A-F、G2、G3 验收项（含路由 SSE、服务事件、澄清闭环、多问题聚合、引用链路、异常分支）。
- 执行方式：后端脚本化验收 + 前端关键链路代码审查。
- G1 阻塞原因：运行 `pnpm frontend:lint` 时提示缺少 `eslint`，受当前环境网络限制无法从 npm 安装依赖。

---

## 建议验收用例（手工）

1. **简单事实问答**：只需1次检索
2. **多问题复合问答**：触发拆分与聚合
3. **含代词追问**：触发改写上下文融合
4. **含歧义问题**：触发 clarification_required
5. **空命中问题**：验证仅知识库回答策略
